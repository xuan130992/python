me: Playwright Tests (Windows)
on:
  schedule:
    - cron: "30 9 * * *"     # 6:00 AM giá» Viá»‡t Nam (UTC+7 = 23:00 UTC hÃ´m trÆ°á»›c)
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  test:
    runs-on: windows-latest   # âœ… cháº¡y trÃªn Windows thay vÃ¬ Ubuntu

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
            python-version: '3.11'

      - name: Install dependencies
        run:
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          playwright install --with-deps

      - name: Run Playwright tests (test_common -> official_homepage)
        run: |
          pytest tests/test_common --html=report2.html --self-contained-html
          pytest tests/official_homepage --html=report1.html --self-contained-html

      - name: Upload test report
        uses: actions/upload-artifact@v4
        with:
            name: test-report
            path: |
              report_common.html
              report_homepage.html

      - name: Send email with report
        uses: dawidd6/action-send-mail@v3
        with:
            server_address: smtp.gmail.com
            server_port: 465
            username: ${{ secrets.EMAIL_USER }}
            password: ${{ secrets.EMAIL_PASS }}
            subject: "ðŸ§ª Daily Playwright Test Report - $(date +'%Y-%m-%d')"
            to: "thanhxuan130992@gmail.com"
            from: "GitHub CI <${{ secrets.EMAIL_USER }}>"
            secure: true
            body: |
              Hello QA Team ðŸ‘‹,

              âœ… The daily Playwright automation test finished at 6:00 AM (Vietnam time).

            Please find attached the detailed HTML reports below:
            - report_common.html
            - report_homepage.html
              Best regards,
              CI/CD Bot ðŸ¤–
        attachments: |
            report_common.html
            report_homepage.html