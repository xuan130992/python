name: ğŸ§ª Playwright Tests (Windows)

on:
  schedule:
    - cron: "0 23 * * *"     # 6:00 AM giá» Viá»‡t Nam (UTC+7 = 23:00 UTC hÃ´m trÆ°á»›c)
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  test:
    runs-on: windows-latest   # âœ… cháº¡y trÃªn Windows Ä‘á»ƒ tÆ°Æ¡ng thÃ­ch Playwright

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          playwright install --with-deps

      - name: Run Playwright tests
        run: |
          pytest tests/test_common tests/official_homepage --env=qa --html=report.html --self-contained-html

      - name: Upload test report
        uses: actions/upload-artifact@v4
        with:
          name: test-report
          path: report.html

      - name: Send email with report
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 465
          username: ${{ secrets.EMAIL_USER }}
          password: ${{ secrets.EMAIL_PASS }}
          subject: "ğŸ§ª Daily Playwright Test Report - $(date +'%Y-%m-%d')"
          to: "thanhxuan130992@gmail.com"
          from: "GitHub CI <${{ secrets.EMAIL_USER }}>"
          secure: true
          body: |
            Hello QA Team ğŸ‘‹,

            âœ… The daily Playwright automation test finished at 6:00 AM (Vietnam time).

            Please find attached the detailed HTML report below.

            Best regards,
            CI/CD Bot ğŸ¤–
          attachments: report.html
